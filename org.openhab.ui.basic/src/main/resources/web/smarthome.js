!function(e){"use strict";function t(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes}function n(e,t){t instanceof NodeList?[].slice.call(t).forEach(function(t){e.appendChild(t)}):e.appendChild(t)}function o(e){var t=e,n="undefined"!=typeof t.type?t.type:"GET",o="undefined"!=typeof t.data?t.data:"",a="undefined"!=typeof t.headers?t.headers:{},r=new XMLHttpRequest;r.open(n,t.url,!0);for(var i in a)r.setRequestHeader(i,a[i]);return r.onload=function(){return r.status<200||r.status>400?void("function"==typeof t.error&&t.error(r)):void("function"==typeof t.callback&&t.callback(r))},r.onerror=function(){"function"==typeof t.error&&t.error(r)},r.send(o),r}function a(e,t){var n=document.getElementById(e).innerHTML;return n.replace(/\{([\w]+)\}/,function(e,n){return"undefined"!=typeof t[n]?t[n]:""})}function r(){function e(e,t){t.forEach(function(t){var n=t[0],o=t[1],a=t[2];e.call(n,o,a)})}var t=this;t.map=e.bind(null,Node.prototype.addEventListener),t.unmap=e.bind(null,Node.prototype.removeEventListener)}function i(){var e=this;e.level=0,e.push=function(t){e.level++,history.pushState({page:t},document.title.textContent)},e.replace=function(e,t){history.replaceState({page:e},document.title.textContent,t)},window.addEventListener("popstate",function(t){e.level--,T.UI.navigate(t.state.page,!1)},!1)}function l(o){function r(e){e=e||window.event,27===e.keyCode&&u.hide()}function i(){document.addEventListener("keydown",r)}function l(){void 0!==u.onHide&&u.onHide(),document.removeEventListener("keydown",r)}var u=this;u.templateId="template-modal",u.text=a(u.templateId,{content:o}),u.show=function(){n(document.body,t(u.text)),u.bg=document.querySelector(e.modal),u.container=u.bg.querySelector(e.modalContainer),T.UI.currentModal=u,u.bg.addEventListener("click",function(){u.hide()}),u.container.addEventListener("click",function(e){e.stopPropagation()}),i()},u.hide=function(){document.body.querySelector(e.modal).remove(),delete T.UI.currentModal,l()}}function u(e,t){var n,o=this,a=!1;o.lock=!1,o.call=function(){n=arguments,o.lock||(a=!1,e.apply(null,n),o.lock=!0,setTimeout(function(){a||e.apply(null,n),o.lock=!1},t))},o.finish=function(){a=!0}}function c(e,t){function n(e){e.widget.setVisible(e.visibility)}var o=this;o.queue=[],o.timeout=null,o.processEvents=function(){for(o.timeout=null;0!==o.queue.length;)n(o.queue[0]),o.queue=o.queue.slice(1)},o.push=function(n){o.queue.length>t||(o.queue.push(n),null===o.timeout?o.timeout=setTimeout(o.processEvents,e):(clearTimeout(o.timeout),o.timeout=setTimeout(o.processEvents,e)))}}function s(t){function n(){this.removeEventListener("error",n),this.src=r}var o=this,a=!1,r="/icon/none.png";o.parentNode=t,o.formRow=t.parentNode,o.item=o.parentNode.getAttribute(e.itemAttribute),o.id=o.parentNode.getAttribute(e.idAttribute),o.icon=o.parentNode.parentNode.querySelector(e.formIcon),o.visible=!o.formRow.classList.contains(e.formRowHidden),o.label=o.parentNode.parentNode.querySelector(e.formLabel),null!==o.icon&&(o.iconName=o.icon.getAttribute(e.iconAttribute),o.icon.src!==r&&o.icon.addEventListener("error",n)),o.reloadIcon=function(e){null!==o.icon&&(o.icon.addEventListener("error",n),o.icon.setAttribute("src","/icon/"+o.iconName+"?state="+encodeURIComponent(e)+"&format="+T.UI.iconType))},o.setVisible=function(t){t?o.formRow.classList.remove(e.formRowHidden):o.formRow.classList.add(e.formRowHidden),o.visible=t},o.setValue=function(e,t,n){o.reloadIcon(t),a?a=!1:o.setValuePrivate(e,t,n)},o.setValuePrivate=function(){},o.setLabel=function(){},o.suppressUpdate=function(){a=!0},o.setLabelColor=function(e){null!==o.label&&(o.label.style.color=e)},o.setValueColor=function(e){o.parentNode.style.color=e},o.destroy=function(){null!==o.icon&&o.icon.removeEventListener("error",n),[].forEach.call(o.parentNode.querySelectorAll("video, audio"),function(e){e instanceof HTMLMediaElement&&e.pause()})}}function d(t){var n=this;n.parentNode=t,n.id=n.parentNode.getAttribute(e.idAttribute),n.visible=!n.parentNode.classList.contains(e.formHidden),n.title=n.parentNode.querySelector(e.formTitle),n.setVisible=function(t){t?n.parentNode.classList.remove(e.formHidden):n.parentNode.classList.add(e.formHidden),n.visible=t},n.setLabel=function(e){n.title.innerHTML=e},n.setValue=function(){},n.setLabelColor=function(){},n.setValueColor=function(){},n.suppressUpdate=function(){},n.destroy=function(){}}function p(t,n){n?s.call(this,t):(this.parentNode=t,this.id=this.parentNode.getAttribute(e.idAttribute));var o=this,a=null,r="images/none.png";o.image=t.querySelector("img"),o.updateInterval=parseInt(t.getAttribute("data-update-interval"),10),o.url=t.getAttribute("data-proxied-url"),o.validUrl="true"===t.getAttribute("data-valid-url"),o.ignoreRefresh="true"===t.getAttribute("data-ignore-refresh"),o.setValuePrivate=function(e,t,n){n?t.startsWith("data:")?(o.ignoreRefresh=!0,o.image.setAttribute("src",t)):"UNDEF"!==t||o.validUrl?(o.ignoreRefresh=!1,o.image.setAttribute("src",o.url+"&t="+Date.now())):(o.ignoreRefresh=!0,o.image.setAttribute("src",r)):(o.ignoreRefresh=!0,o.image.setAttribute("src",r))},o.setVisible=function(t){t?(o.formRow.classList.remove(e.formRowHidden),o.activateRefresh()):(o.formRow.classList.add(e.formRowHidden),o.deactivateRefresh()),o.visible=t},o.deactivateRefresh=function(){null!==a&&(clearInterval(a),a=null)},o.activateRefresh=function(){o.deactivateRefresh(),0===o.updateInterval||o.ignoreRefresh||(o.updateInterval<100&&(o.updateInterval=100),a=setInterval(function(){return 0===o.image.clientWidth?void clearInterval(a):void o.image.setAttribute("src",o.url+"&t="+Date.now())},o.updateInterval))},o.destroy=function(){var e=o.image.parentNode;o.image.setAttribute("src",r),e.removeChild(o.image)},o.visible&&o.activateRefresh()}function v(e){s.call(this,e);var t=this;t.hasValue="true"===t.parentNode.getAttribute("data-has-value"),t.setValuePrivate=function(n){t.hasValue&&(e.innerHTML=n)}}function f(t){s.call(this,t);var n=this;n.hasValue="true"===n.parentNode.getAttribute("data-has-value"),n.value=n.parentNode.parentNode.querySelector(e.formValue),n.count=1*n.parentNode.getAttribute("data-count"),n.suppressUpdateButtons=!1,n.reset=function(){n.buttons.forEach(function(t){t.classList.remove(e.buttonActiveClass)})},n.onclick=function(){var t=this.getAttribute("data-value")+"";1!==n.count&&(n.reset(),this.classList.add(e.buttonActiveClass)),n.parentNode.dispatchEvent(C("control-change",{item:n.item,value:t})),n.suppressUpdateButtons=!0},n.valueMap={},n.buttons=[].slice.call(n.parentNode.querySelectorAll(e.controlButton)),n.setValuePrivate=function(t,o){if(n.hasValue&&(n.value.innerHTML=t),1!==n.count){if(n.suppressUpdateButtons)return void(n.suppressUpdateButtons=!1);n.reset(),void 0!==n.valueMap&&void 0!==n.valueMap[o]&&n.valueMap[o].classList.add(e.buttonActiveClass)}},n.setValueColor=function(e){n.value.style.color=e},n.buttons.forEach.call(n.buttons,function(e){var t=e.getAttribute("data-value")+"";n.valueMap[t]=e,e.addEventListener("click",n.onclick)}),n.destroy=function(){n.buttons.forEach(function(e){e.removeEventListener("click",n.onclick)}),componentHandler.downgradeElements(n.buttons)}}function m(t){function n(e){if(e.stopPropagation(),"input"===e.target.tagName.toLowerCase()){var t=e.target.getAttribute("value");o.parentNode.dispatchEvent(C("control-change",{item:o.item,value:t})),setTimeout(function(){o.modal.hide()},300)}}s.call(this,t);var o=this,a=t.getAttribute("data-value-map");o.value=null,o.valueNode=t.parentNode.querySelector(e.formValue),null!==a?o.valueMap=JSON.parse(a):o.valueMap={},o.showModal=function(){var t=o.parentNode.querySelector(e.selectionRows).innerHTML;o.modal=new l(t),o.modal.show(),o.modal.onHide=function(){var t=[].slice.call(o.modal.container.querySelectorAll(e.formRadio));componentHandler.downgradeElements(t),t.forEach(function(e){e.removeEventListener("click",n)}),o.modal=null};var a=[].slice.call(o.modal.container.querySelectorAll(e.formRadio));if(null!==o.value){var r=[].slice.call(o.modal.container.querySelectorAll("input[type=radio]"));r.forEach(function(e){e.value===o.value?e.checked=!0:e.checked=!1})}a.forEach(function(e){componentHandler.upgradeElement(e,"MaterialRadio"),e.addEventListener("click",n)})},o.setValuePrivate=function(e,t){o.value=""+t,void 0!==o.valueMap[t]?o.valueNode.innerHTML=T.UI.escapeHtml(o.valueMap[t]):o.valueNode.innerHTML=""},o.setValueColor=function(e){o.valueNode.style.color=e},o.destroy=function(){o.parentNode.parentNode.removeEventListener("click",o.showModal)},o.parentNode.parentNode.addEventListener("click",o.showModal)}function h(t){function n(e){u.parentNode.dispatchEvent(C("control-change",{item:u.item,value:e}))}function o(e,t){i=!1,d=!0,l=setTimeout(function(){i=!0,n(e)},c),t.stopPropagation(),t.preventDefault()}function a(e,t){clearTimeout(l),d&&(d=!1,n(i?"STOP":e),t.stopPropagation(),t.preventDefault())}function r(e){n("STOP"),e.stopPropagation(),e.preventDefault()}s.call(this,t);var i,l,u=this,c=300,d=!1;u.buttonUp=u.parentNode.querySelector(e.rollerblind.up),u.buttonDown=u.parentNode.querySelector(e.rollerblind.down),u.buttonStop=u.parentNode.querySelector(e.rollerblind.stop),u.hasValue="true"===u.parentNode.getAttribute("data-has-value"),u.valueNode=u.parentNode.parentNode.querySelector(e.formValue),u.setValuePrivate=function(e){u.hasValue&&("DOWN"===e?e="100":"UP"===e&&(e="0"),u.valueNode.innerHTML=e)};var p=a.bind(null,"UP"),v=o.bind(null,"UP"),f=a.bind(null,"DOWN"),m=o.bind(null,"DOWN"),h=[[u.buttonUp,"touchstart",v],[u.buttonUp,"mousedown",v],[u.buttonUp,"touchend",p],[u.buttonUp,"mouseup",p],[u.buttonUp,"mouseleave",p],[u.buttonDown,"touchstart",m],[u.buttonDown,"mousedown",m],[u.buttonDown,"touchend",f],[u.buttonDown,"mouseup",f],[u.buttonDown,"mouseleave",f],[u.buttonStop,"mousedown",r],[u.buttonStop,"touchstart",r]];u.destroy=function(){componentHandler.downgradeElements([u.buttonUp,u.buttonDown,u.buttonStop]),T.eventMapper.unmap(h)},T.eventMapper.map(h)}function b(t){function n(e,t){var n=o.value+(e===!0?o.step:-o.step);n=n>o.max?o.max:n,n=n<o.min?o.min:n;var a=n;o.unit&&(a=n+" "+o.unit),o.parentNode.dispatchEvent(C("control-change",{item:o.item,value:a})),o.value=n,t.stopPropagation(),t.preventDefault()}s.call(this,t);var o=this;o.up=o.parentNode.querySelector(e.setpoint.up),o.down=o.parentNode.querySelector(e.setpoint.down),o.value=o.parentNode.getAttribute("data-value"),o.max=parseFloat(o.parentNode.getAttribute("data-max")),o.min=parseFloat(o.parentNode.getAttribute("data-min")),o.step=parseFloat(o.parentNode.getAttribute("data-step")),o.value=isNaN(parseFloat(o.value))?0:parseFloat(o.value),o.valueNode=o.parentNode.parentNode.querySelector(e.formValue),o.unit=o.parentNode.getAttribute("data-unit"),o.setValuePrivate=function(e,t){if(t.indexOf(" ")>0){var n=t.split(" ");o.value=1*n[0],o.unit=n[1]}else o.value=1*t;o.valueNode.innerHTML=e};var a=n.bind(null,!0),r=n.bind(null,!1),i=[[o.up,"mousedown",a],[o.up,"touchstart",a],[o.down,"mousedown",r],[o.down,"touchstart",r]];o.destroy=function(){componentHandler.downgradeElements([o.up,o.down]),T.eventMapper.unmap(i)},T.eventMapper.map(i)}function g(t,n,o){function a(e){var t=e.r,n=e.g,o=e.b;t/=255,n/=255,o/=255;var a,r,i=Math.max(t,n,o),l=Math.min(t,n,o),u=i,c=i-l;if(r=0===i?0:c/i,i===l)a=0;else{switch(i){case t:a=(n-o)/c+(n<o?6:0);break;case n:a=(o-t)/c+2;break;case o:a=(t-n)/c+4}a/=6}return{h:a,s:r,v:u}}function r(e){var t=e.h,n=e.s,o=e.v,a=(2-n)*o,r=a<1?a:2-a;return{h:t,s:0===r?0:n*o/r,l:a/2}}function i(e){var t;t=void 0!==e.touches?{x:e.touches[0].pageX-m.colorpicker.offsetLeft,y:e.touches[0].pageY-m.colorpicker.offsetTop}:{x:e.pageX-m.colorpicker.offsetLeft,y:e.pageY-m.colorpicker.offsetTop};var n=m.image.clientWidth/2,o=t.x-n,a=t.y-n,i=a*a+o*o;if(i>n*n){var l=1-Math.abs(n/Math.sqrt(i));t.x-=o*l,t.y-=a*l}m.handle.style.left=t.x/m.image.clientWidth*100+"%",m.handle.style.top=t.y/m.image.clientWidth*100+"%";var u=o>=0?(2*Math.PI-Math.atan(a/o)+Math.PI/2)/(2*Math.PI):(2*Math.PI-Math.atan(a/o)-Math.PI/2)/(2*Math.PI),c={h:isNaN(u)?0:u,s:Math.sqrt(i)/n,v:1},s=r(c);m.hsvValue={h:c.h,s:c.s,v:m.slider.value/100},s.l=s.l<.5?.5:s.l,m.background.style.background="hsl("+360*s.h+", 100%, "+Math.round(100*s.l)+"%)"}function l(e){var t=a(e);m.slider.value=100*t.v;var n=50+Math.round(t.s*Math.cos(2*Math.PI*t.h)*50),o=50+Math.round(t.s*Math.sin(2*Math.PI*t.h)*50);m.handle.style.top=n+"%",m.handle.style.left=o+"%",t.v=1;var r=g.hsv2rgb(t);m.background.style.background="rgb("+Math.round(r.r)+","+Math.round(r.g)+","+Math.round(r.b)+")"}function c(){null!==m.interval&&(clearInterval(m.interval),m.interval=null),m.isBeingChanged=!1,window.removeEventListener("mouseup",c)}function s(e){m.interval=setInterval(function(){o(m.hsvValue)},300),window.addEventListener("mouseup",c),i(e),o(m.hsvValue),m.isBeingChanged=!0,e.stopPropagation()}function d(e){(void 0!==e.touches||1&e.buttons)&&(i(e),e.stopPropagation(),e.preventDefault())}function p(e){null!==m.interval&&(clearInterval(m.interval),m.interval=null),window.removeEventListener("mouseup",c),m.isBeingChanged=!1,e.stopPropagation()}function v(){m.hsvValue.v=m.slider.value/100,m.debounceProxy.call()}function f(){m.hsvValue.v=m.slider.value/100,m.debounceProxy.call(),m.debounceProxy.finish()}var m=this;m.container=t,m.value=n,m.hsvValue=a(n),m.interval=null,m.isBeingChanged=!1,m.colorpicker=m.container.querySelector(e.colorpicker.colorpicker),m.image=m.container.querySelector(e.colorpicker.image),m.background=m.container.querySelector(e.colorpicker.background),m.handle=m.container.querySelector(e.colorpicker.handle),m.slider=m.container.querySelector(e.colorpicker.slider),m.button=m.container.querySelector(e.controlButton),componentHandler.upgradeElement(m.button,"MaterialButton"),componentHandler.upgradeElement(m.button,"MaterialRipple"),m.debounceProxy=new u(function(){o(m.hsvValue)},200),m.updateColor=function(e){m.isBeingChanged||l(e)};var h=[[m.slider,"change",v],[m.slider,"touchend",f],[m.slider,"mouseup",f],[m.image,"mousedown",d],[m.image,"mousemove",d],[m.image,"touchmove",d],[m.image,"touchstart",d],[m.image,"touchend",p],[m.image,"mouseup",p],[m.image,"mousedown",s],[m.image,"touchstart",s]];m.destroy=function(){T.eventMapper.unmap(h),componentHandler.downgradeElements([m.button])},T.eventMapper.map(h),l(n)}function y(t){function n(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}function o(e){d.parentNode.dispatchEvent(C("control-change",{item:d.item,value:e}))}function r(e){d.pressed=!0,d.longPress=!1,c=setInterval(function(){d.longPress=!0,o(e)},p)}function i(e){d.pressed&&(d.longPress||o(e),d.pressed=!1,d.longPress=!1,clearInterval(c))}function u(){function t(){d.modal.hide()}var n;d.modal=new l(a("template-colorpicker")),d.modal.show(),d.modal.container.classList.add(e.colorpicker.modalClass),d.modal.onHide=function(){n.removeEventListener("click",t),d.modalControl.destroy(),d.modalControl=null,d.modal=null},d.modalControl=new g(d.modal.container,d.value,function(e){d.value=g.hsv2rgb(e),o(Math.round(360*e.h%360)+","+Math.round(100*e.s%100)+","+Math.round(100*e.v))}),n=d.modal.container.querySelector(e.colorpicker.button),n.addEventListener("click",t)}s.call(this,t);var c,d=this,p=300;d.value=n(d.parentNode.getAttribute("data-value")),d.modalControl=null,d.buttonUp=d.parentNode.querySelector(e.colorpicker.up),d.buttonDown=d.parentNode.querySelector(e.colorpicker.down),d.buttonPick=d.parentNode.querySelector(e.colorpicker.pick),d.longPress=!1,d.pressed=!1,d.setValue=function(e){var t=e.split(","),n={h:t[0]/360,s:t[1]/100,v:t[2]/100};d.value=g.hsv2rgb(n),null!==d.modalControl&&d.modalControl.updateColor(d.value)};var v=r.bind(null,"INCREASE"),f=r.bind(null,"DECREASE"),m=i.bind(null,"ON"),h=i.bind(null,"OFF"),b=[[d.buttonUp,"touchstart",v],[d.buttonUp,"mousedown",v],[d.buttonUp,"mouseleave",m],[d.buttonUp,"touchend",m],[d.buttonUp,"mouseup",m],[d.buttonDown,"touchstart",f],[d.buttonDown,"mousedown",f],[d.buttonDown,"touchend",h],[d.buttonDown,"mouseup",h],[d.buttonDown,"mouseleave",h],[d.buttonPick,"click",u]];d.destroy=function(){T.eventMapper.unmap(b),componentHandler.downgradeElements([d.buttonUp,d.buttonDown,d.buttonPick])},T.eventMapper.map(b)}function w(t){function n(){o.parentNode.dispatchEvent(C("control-change",{item:o.item,value:o.input.checked?"ON":"OFF"}))}s.call(this,t);var o=this;o.input=o.parentNode.querySelector("input[type=checkbox]"),o.hasValue="true"===o.parentNode.getAttribute("data-has-value"),o.valueNode=o.parentNode.parentNode.querySelector(e.formValue),o.setValuePrivate=function(e,t){var n="ON"===t;o.input.checked!==n&&(o.input.checked=n,n?o.parentNode.MaterialSwitch.on():o.parentNode.MaterialSwitch.off()),o.hasValue&&(o.valueNode.innerHTML=e)},o.setValueColor=function(e){o.valueNode.style.color=e},o.destroy=function(){o.input.removeEventListener("change",n),componentHandler.downgradeElements([o.parentNode])},o.input.addEventListener("change",n)}function N(t){function n(){var e=i.input.value;i.unit&&(e=e+" "+i.unit),i.parentNode.dispatchEvent(C("control-change",{item:i.item,value:e}))}function o(){i.debounceProxy.call()}function a(){null!==l&&clearTimeout(l),i.locked=!0,T.changeListener.pause()}function r(){i.debounceProxy.call(),setTimeout(function(){T.changeListener.resume()},5),l=setTimeout(function(){i.locked=!1},300),i.debounceProxy.finish()}s.call(this,t);var i=this;i.input=i.parentNode.querySelector("input[type=range]"),i.hasValue="true"===i.parentNode.getAttribute("data-has-value"),i.valueNode=i.parentNode.parentNode.querySelector(e.formValue),i.locked=!1,i.unit=i.parentNode.getAttribute("data-unit"),function(){var e=parseInt(i.input.getAttribute("data-state"),10);isNaN(e)?i.input.value=0:i.input.value=e,i.input.MaterialSlider&&i.input.MaterialSlider.change()}(),i.debounceProxy=new u(function(){n()},200),i.setValuePrivate=function(e,t){return i.hasValue&&(i.valueNode.innerHTML=e),i.locked?void i.reloadIcon(t):(i.input.value=t,void i.input.MaterialSlider.change())},i.setValueColor=function(e){i.valueNode.style.color=e};var l=null,c=[[i.input,"touchstart",a],[i.input,"mousedown",a],[i.input,"touchend",r],[i.input,"mouseup",r],[i.input,"change",o]];i.destroy=function(){T.eventMapper.unmap(c),componentHandler.downgradeElements([i.input])},T.eventMapper.map(c)}function k(t){function n(){T.UI.navigate(o.target,!0)}s.call(this,t);var o=this;o.target=t.getAttribute("data-target"),o.hasValue="true"===o.parentNode.getAttribute("data-has-value"),o.container=t.parentNode.querySelector(e.formValue),o.setValuePrivate=function(e){o.hasValue&&(o.container.innerHTML=e)},o.setValueColor=function(e){o.container.style.color=e},o.destroy=function(){t.parentNode.removeEventListener("click",n)},t.parentNode.addEventListener("click",n)}function E(e){o({type:"POST",url:"/rest/items/"+e.detail.item,data:e.detail.value,headers:{"Content-Type":"text/plain"}})}function L(t){function n(e){var t=e.documentElement,n=[];if("page"===t.tagName){[].forEach.call(t.childNodes,function(e){e instanceof Text||n.push(e)}),r.setTitle(n[0].textContent);for(var o=document.querySelector(".page-content");o.firstChild;)o.removeChild(o.firstChild);o.insertAdjacentHTML("beforeend",n[1].textContent)}}var a={Loading:1,Idle:2},r=this,l=a.Idle,u=new i;r.page=document.body.getAttribute("data-page-id"),r.sitemap=document.body.getAttribute("data-sitemap"),r.destination=null,r.root=t,r.loading=r.root.querySelector(e.uiLoadingBar),r.layoutTitle=document.querySelector(e.layoutTitle),r.iconType=document.body.getAttribute(e.iconTypeAttribute),r.notification=document.querySelector(e.notify),r.escapeHtml=function(e){for(var t=e,n=[[/&/g,"&amp;"],[/</g,"&lt;"],[/>/g,"&gt;"]],o=0;o<n.length;o++)t=t.replace(n[o][0],n[o][1]);return t},r.setTitle=function(e){document.querySelector("title").innerHTML=e,r.layoutTitle.innerHTML=e},r.upgradeComponents=function(){var t=componentHandler.upgradeElement;[].slice.call(document.querySelectorAll(e.formControls)).forEach(function(e){switch(e.getAttribute("data-control-type")){case"setpoint":case"rollerblind":case"colorpicker":case"buttons":[].slice.call(e.querySelectorAll("button")).forEach(function(e){t(e,"MaterialButton"),t(e,"MaterialRipple")});break;case"checkbox":t(e,"MaterialSwitch");break;case"slider":t(e.querySelector("input[type=range]"),"MaterialSlider")}})},r.showLoadingBar=function(){r.loading.style.display="block"},r.hideLoadingBar=function(){r.loading.style.display=""},r.navigateCallback=function(t){l=a.Idle,r.pushState&&u.push(r.page),[].forEach.call(document.querySelectorAll(e.formControls),function(e){e.removeEventListener("control-change",E)});for(var o in T.dataModel)T.dataModel[o].destroy();n(t.responseXML),r.pushState&&u.replace(r.newPage,r.destination),r.page=r.newPage,r.upgradeComponents(),r.initControls(),r.hideLoadingBar(),r.sitemap!==r.page?(r.header.classList.remove("navigation-home"),r.header.classList.add("navigation-page")):(r.header.classList.add("navigation-home"),r.header.classList.remove("navigation-page")),T.changeListener.navigate(r.page)},r.navigate=function(e,t){l===a.Idle&&(l=a.Loading,r.pushState=void 0===t||t===!0,r.newPage=e,r.showLoadingBar(),r.destination="/basicui/app?w="+e+"&sitemap="+T.UI.sitemap,o({url:r.destination+"&subscriptionId="+T.subscriptionId+"&__async=true",callback:r.navigateCallback}),void 0!==T.UI.currentModal&&T.UI.currentModal.hide())},r.initControls=function(){function t(e){e.id.length>0&&(T.dataModel[e.id]=e)}T.dataModel={},[].forEach.call(document.querySelectorAll(e.formControls),function(e){switch(e.getAttribute("data-control-type")){case"setpoint":t(new b(e));break;case"rollerblind":t(new h(e));break;case"buttons":t(new f(e));break;case"selection":t(new m(e));break;case"checkbox":t(new w(e));break;case"slider":t(new N(e));break;case"chart":case"image":t(new p(e,(!0)));break;case"image-link":t(new p(e,(!1)));case"text-link":case"group":t(new k(e));break;case"text":t(new v(e));break;case"colorpicker":t(new y(e));break;case"video":case"webview":case"mapview":t(new s(e))}e.addEventListener("control-change",E)}),[].forEach.call(document.querySelectorAll(e.form),function(e){t(new d(e))})},r.showNotification=function(t){r.notification.innerHTML=t,r.notification.classList.remove(e.notifyHidden)},r.hideNotification=function(){r.notification.classList.add(e.notifyHidden)},u.replace(r.page,document.location.href),function(){r.header=document.querySelector(e.layoutHeader),r.sitemap!==r.page&&(r.header.classList.remove("navigation-home"),r.header.classList.add("navigation-page")),document.querySelector(e.backButton).addEventListener("click",function(){u.level>0?history.back():location.href=location.origin+"/basicui/app?sitemap="+T.UI.sitemap})}()}function M(){this.paused=!1,this.pause=function(){this.paused=!0},this.resume=function(){this.paused=!1},this.extractValueFromLabel=function(e){var t=null;if("string"==typeof e&&e.indexOf("[")!==-1&&e.indexOf("]")!==-1){var n=e.indexOf("[")+1;t=e.substr(n,e.lastIndexOf("]")-n)}return t},this.getTitleFromLabel=function(e){var t=this.extractValueFromLabel(e),n=null;return null!==t&&(n=e.substr(0,e.indexOf("["))+t),n},this.updateWidget=function(e,t){var n=this.extractValueFromLabel(t.label),o=!1;e.visible!==t.visibility&&(o=t.visibility,T.UI.layoutChangeProxy.push({widget:e,visibility:t.visibility})),(o||"NULL"!==t.state)&&(null===n&&(n=t.state),e.setValue(T.UI.escapeHtml(n),t.state,t.visibility)),[{apply:e.setLabel,data:t.label,fallback:null},{apply:e.setLabelColor,data:t.labelcolor,fallback:""},{apply:e.setValueColor,data:t.valuecolor,fallback:""}].forEach(function(e){void 0!==e.data?e.apply(e.data):null!==e.fallback&&e.apply(e.fallback)})}}function S(e){M.call(this);var t=this;t.navigate=function(){},t.source=new EventSource(e),t.source.addEventListener("event",function(e){if(!t.paused){var n,o,a=JSON.parse(e.data);if("ALIVE"!==a.TYPE){if("SITEMAP_CHANGED"===a.TYPE){var r=window.location.href,i=r.split("?");return i.length>1?window.location.href=i[0]+"?sitemap="+a.sitemapName:window.location.reload(!0),void t.pause()}if(a.widgetId in T.dataModel||a.widgetId===T.UI.page)if(n=void 0===a.state?a.item.state:a.state,o=t.getTitleFromLabel(a.label),a.widgetId===T.UI.page&&null!==o)T.UI.setTitle(T.UI.escapeHtml(o));else if(void 0!==T.dataModel[a.widgetId]){var l={visibility:a.visibility,state:n,label:a.label,labelcolor:a.labelcolor,valuecolor:a.valuecolor};t.updateWidget(T.dataModel[a.widgetId],l)}}}}),t.source.onerror=function(){t.source.close(),t.connectionError()}}function I(){function e(e){function t(e){e.forEach(function(e){if(void 0!==e.widgetId&&void 0!==T.dataModel[e.widgetId]){var t,o=T.dataModel[e.widgetId],a="NULL";void 0!==e.item&&(a=void 0===e.state?e.item.state:e.state),o.visible&&void 0===e.item||(t={visibility:!0,state:a,label:e.label,labelcolor:e.labelcolor,valuecolor:e.valuecolor},n.updateWidget(o,t)),o.handled=!0}})}var o,a;try{e=JSON.parse(e)}catch(r){return}o=n.getTitleFromLabel(e.title),null!==o&&T.UI.setTitle(T.UI.escapeHtml(o));for(a in T.dataModel)T.dataModel[a].handled=!1;t(e.widgets),e.widgets.forEach(function(e){t(e.widgets)});for(a in T.dataModel){var i=T.dataModel[a];i.visible&&!i.handled&&T.UI.layoutChangeProxy.push({widget:i,visibility:!1})}}function t(){var a=Math.random().toString(16).slice(2);n.request=o({url:"/rest/sitemaps/"+n.sitemap+"/"+n.page+"?_="+a,headers:{"X-Atmosphere-Transport":"long-polling"},callback:function(o){n.paused||e(o.responseText),setTimeout(function(){t()},1)},error:function(){setTimeout(function(){t()},1e3)}})}M.call(this);var n=this;n.sitemap=document.body.getAttribute("data-sitemap"),n.page=document.body.getAttribute("data-page-id"),n.navigate=function(e){n.request.abort(),n.page=e,t()},n.pause=function(){n.request.abort(),n.paused=!0},n.resume=function(){n.paused=!1,t()},t()}function A(){function t(e){q.eventSource&&null!==e?S.call(r,e):I.call(r)}function n(){r.startSubscriber(r.subscribeResponse),r.subscribeResponse=null}var r=this;r.subscribeRequestURL="/rest/sitemaps/events/subscribe",r.reconnectInterval=null,r.subscribeResponse=null,r.suppressErrorsState=!1,r.connectionRestored=function(e){clearInterval(r.reconnectInterval),r.navigate=n,r.subscribeResponse=e,T.UI.hideNotification(),T.UI.navigate(T.UI.page,!1)},r.connectionError=function(){if(!r.suppressErrorsState){var t=a(e.notifyTemplateOffline,{});T.UI.showNotification(t),r.reconnectInterval=setInterval(function(){o({url:r.subscribeRequestURL,type:"POST",callback:r.connectionRestored})},1e4)}},r.suppressErrors=function(){r.suppressErrorsState=!0},r.startSubscriber=function(e){var n,o,a,r,i,l;try{n=JSON.parse(e.responseText)}catch(u){return}if("CREATED"===n.status){try{o=n.context.headers.Location[0]}catch(u){return}a=o.split("/"),i=a[a.length-1],r=document.body.getAttribute("data-sitemap"),l=document.body.getAttribute("data-page-id"),T.subscriptionId=i,t(o+"?sitemap="+r+"&pageid="+l)}},r.subscriberError=function(){var n=a(e.notifyTemplateLongPollingMode,{});T.UI.showNotification(n),t(null)},o({url:r.subscribeRequestURL,type:"POST",callback:r.startSubscriber,error:r.subscriberError})}var C,T={dataModel:{}},q={eventLayerXY:function(){var e;return e=void 0===document.createEvent?new MouseEvent(null):document.createEvent("MouseEvent"),void 0!==e.layerX}(),pointerEvents:void 0!==document.createElement("div").style.pointerEvents,customEvent:function(){var e=!0;try{new CustomEvent("event",{})}catch(t){e=!1}return e}(),elementRemove:void 0!==Element.prototype.remove,flexbox:void 0!==document.createElement("div").style.flexBasis,flexboxLegacy:function(){var e=document.createElement("div");return void 0!==e.style.boxDirection||void 0!==e.style.webkitBoxDirection}(),eventSource:"EventSource"in window};!function(){C=q.customEvent?function(e,t){return new CustomEvent(e,{detail:t})}:function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!0,!1,t),n},q.elementRemove||(Element.prototype.remove=function(){this.parentNode.removeChild(this)}),!q.flexbox&&q.flexboxLegacy&&document.documentElement.classList.add("flexbox-legacy")}(),g.hsv2rgb=function(e){var t,n,o,a=e.h,r=e.s,i=e.v,l=Math.floor(6*a),u=6*a-l,c=i*(1-r),s=i*(1-u*r),d=i*(1-(1-u)*r);switch(l%6){case 0:t=i,n=d,o=c;break;case 1:t=s,n=i,o=c;break;case 2:t=c,n=i,o=d;break;case 3:t=c,n=s,o=i;break;case 4:t=d,n=c,o=i;break;case 5:t=i,n=c,o=s}return{r:255*t,g:255*n,b:255*o}},document.addEventListener("DOMContentLoaded",function(){T.UI=new L(document),T.UI.layoutChangeProxy=new c(100,50),T.eventMapper=new r,T.UI.initControls(),T.changeListener=new A,window.addEventListener("beforeunload",function(){T.changeListener.suppressErrors()})})}({itemAttribute:"data-item",idAttribute:"data-widget-id",iconAttribute:"data-icon",iconTypeAttribute:"data-icon-type",controlButton:"button",buttonActiveClass:"mdl-button--accent",modal:".mdl-modal",modalContainer:".mdl-modal__content",selectionRows:".mdl-form__selection-rows",form:".mdl-form",formTitle:".mdl-form__title",formHidden:"mdl-form--hidden",formControls:".mdl-form__control",formRowHidden:"mdl-form__row--hidden",formValue:".mdl-form__value",formRadio:".mdl-radio",formRadioControl:".mdl-radio__button",formIcon:".mdl-form__icon img",formLabel:".mdl-form__label",uiLoadingBar:".ui__loading",layoutTitle:".mdl-layout-title",layoutHeader:".mdl-layout__header",backButton:".navigation__button-back",rollerblind:{up:".mdl-form__rollerblind--up",down:".mdl-form__rollerblind--down",stop:".mdl-form__rollerblind--stop"},setpoint:{up:".mdl-form__setpoint--up",down:".mdl-form__setpoint--down"},colorpicker:{up:".mdl-form__colorpicker--up",down:".mdl-form__colorpicker--down",pick:".mdl-form__colorpicker--pick",modalClass:"mdl-modal--colorpicker",image:".colorpicker__image",handle:".colorpicker__handle",slider:".colorpicker__brightness",background:".colorpicker__background",colorpicker:".colorpicker",button:".colorpicker__buttons > button"},notify:".mdl-notify__container",notifyHidden:"mdl-notify--hidden",notifyTemplateOffline:"template-offline-notify",notifyTemplateLongPollingMode:"template-long-polling-mode-notify"});